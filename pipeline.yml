resources:
  - name: source-code
    type: git
    source:
      uri: {{GIT_REPO}}
      branch: {{GIT_REPO_BRANCH}}
  - name: deploy-service
    type: cf
    source:
      api: {{CF_API}}
      username: {{CF_USER}}
      password: {{CF_PASS}}
      organization: {{CF_ORG}}
      space: {{CF_SPACE}}
      skip_cert_check: true

jobs:
  - name: package-product-service
    plan:
    - get: source-code
      trigger: true
    - task: create-services
      privileged: true
      file: source-code/create-services.yml
      params:
        CF_API: {{CF_API}}
        CF_USER: {{CF_USER}}
        CF_PASS: {{CF_PASS}}
        CF_ORG:  {{CF_ORG}}
        CF_SPACE: {{CF_SPACE}}
        JRC_EUREKA: {{JRC_EUREKA}}
    - task: package
      privileged: true
      file: source-code/product-service/build.yml
    - put: deploy-service
      params: 
        manifest: source-code/product-service/manifest.yml
        path: product-service-artifacts/product-service-0.0.1-SNAPSHOT.jar
  - name: package-photo-service
    plan:
    - get: source-code
      trigger: true
    - task: create-services
      privileged: true
      file: source-code/create-services.yml
      params:
        CF_API: {{CF_API}}
        CF_USER: {{CF_USER}}
        CF_PASS: {{CF_PASS}}
        CF_ORG:  {{CF_ORG}}
        CF_SPACE: {{CF_SPACE}}
        JRC_EUREKA: {{JRC_EUREKA}}
    - task: package
      privileged: true
      file: source-code/photo-service/build.yml
    - put: deploy-service
      params:
        manifest: source-code/photo-service/manifest.yml
        path: photo-service-artifacts/photo-service-0.0.1-SNAPSHOT.jar
  - name: package-product-ui
    plan:
    - get: source-code
      trigger: true
    - task: create-services
      privileged: true
      file: source-code/create-services.yml
      params:
        CF_API: {{CF_API}}
        CF_USER: {{CF_USER}}
        CF_PASS: {{CF_PASS}}
        CF_ORG:  {{CF_ORG}}
        CF_SPACE: {{CF_SPACE}}
        JRC_EUREKA: {{JRC_EUREKA}}
    - task: package
      privileged: true
      file: source-code/product-ui/build.yml
    - put: deploy-service
      params:
        manifest: source-code/product-ui/manifest.yml
        path: product-ui-artifacts/product-ui-0.0.1-SNAPSHOT.jar

